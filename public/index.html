<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Beoning</title>

<meta name="description" content="">
<meta name="author" content="">
<link rel="canonical" href="https://www.soundpill.cn/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css" integrity="sha256-yIlj/i15RiAA/Q&#43;xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.soundpill.cn/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.soundpill.cn/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.soundpill.cn/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.soundpill.cn/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.soundpill.cn/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.92.0" />
<link rel="alternate" type="application/rss+xml" href="https://www.soundpill.cn/index.xml">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Beoning" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.soundpill.cn/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Beoning"/>
<meta name="twitter:description" content=""/>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Beoning",
  "url": "https://www.soundpill.cn",
  "description": "",
  "thumbnailUrl": "https://www.soundpill.cn/favicon.ico",
  "sameAs": [
      
  ]
}
</script>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.soundpill.cn" accesskey="h" title="Beoning (Alt + H)">Beoning</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main"> 

<article class="first-entry"> 
  <header class="entry-header">
    <h2>将视频切割为均等的时间长度
    </h2>
  </header>
  <section class="entry-content">
    <p>前情提要 有时候在某些软件中将单次可发送的视频时长限制为 5 分钟或者 15 分钟, 总之就是一个固定的长度, 这样在我们发送超过时长的视频时会比较不方便.
所以写一段程序来自动按照传入的时间来等分视频.
当然这只是其中一个场景.
利用 goroutine 和 FFmpeg 首先获取视频长度信息可以通过 ffprobe 命令来获取, 这个是 FFmpeg 下的一个工具包, 安装 FFmpeg 后就会有了.
然后拿到视频总时长后根据传入的分钟数来分割视频, 这时候就需要用到 ffmpeg 命令了.
最后启动 goroutine 来异步分割每一段视频, 最终完成.
工具地址 https://github.com/muyehub/cut_video_avg</p>
  </section>
  <footer class="entry-footer"><span title='2021-12-02 14:48:45 +0800 CST'>December 2, 2021</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to 将视频切割为均等的时间长度" href="https://www.soundpill.cn/posts/2021-12-02-cut-video-avg/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>golang 编程陷阱---摘自《go 专家编程》
    </h2>
  </header>
  <section class="entry-content">
    <p>关于切片扩容 在使用 append 向 slice 中追加元素时，如果 slice 容量不足以存储新元素，则会把当前切片扩容并产生一个新的切片。如下：
package main import &#34;fmt&#34; func main() { s := make([]int, 0) w := append(s, 1) t := append(s, 2) v := append(s, 3) fmt.Printf(&#34;%p, %p , %p , %p, %p&#34;, s, w, t, v) } // 0x116ce80, 0xc00001c198 , 0xc00001c1a0 , 0xc00001c1a8 append 会每次都生成一个新的切片，并且每次都会做扩容操作，元切片 s 并没有改变任何。
所以，在操作中要将 append 的返回值接收，如果不接收编译器会报错，如果用 _ 忽略返回值，则需要考虑扩容的情况，避免滥用。
空切片 向 slice 中 append 空值(nil)时也会增加 slice 的长度，这在有些情况下可能会导致严重的错误，并且不易察觉，书中举了一个 Kubernetes 项目中的例子。
有一个错误收集器，用来将验证函数的一系列错误收集到一个 slice 中，检查 slice 的长度如果大于 0 时，说明有错误产生，则程序退出，如下：...</p>
  </section>
  <footer class="entry-footer"><span title='2021-11-02 23:47:33 +0800 CST'>November 2, 2021</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to golang 编程陷阱---摘自《go 专家编程》" href="https://www.soundpill.cn/posts/2021-11-02-golang-coding-trap/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>php-tips
    </h2>
  </header>
  <section class="entry-content">
    <p>在 foreach 中不要使用 array_merge，不仅慢而且耗费内存，可以在 foreach 中对要合并的数组进行赋值，在 foreach 外部统一进行合并，具体性能差异可以参考这篇文章：不要在循环体中使用 array_merge()
  在 foreach 中也不要使用 array_push，可以通过向数组中赋值的方式代替，比如：$students[] = $student[‘id’]， 而不是 array_push($students, $student[‘id’])，具体性能差异可以参考这篇文章：不要在循环体中使用 array_push()
  针对一些查询较为复杂或者比较核心的逻辑里的 sql 查询，可以将 sql 语句写到注释中，这样看代码的时候不用再去拼接 sql，直接用注释中的 sql 拿来排查问题
  如果使用 phpstorm 可以安装 php inspections 插件来进行代码的静态分析，可以帮助查找代码规范，语法漏洞，函数使用方式方面的错误。其他的一些代码质量工具可以配置使用 phpcs，phpmd，phpcs-fixer，psalm，phpstan 等。而且可以通过 phpstorm 的热键录制功能，将徽标键 &#43; s 设置为 phpcs-fixer，format code 的快捷键，这样写完时可以通过快捷键格式化代码。
  为避免在项目中将 dd，var_dump，exit，die 等函数提交到远程版本库中，可以在项目的 .git/hooks/pre-commit 中进行控制，加入下面的代码，每次提交时可以检测到。参考的这个：pre-commit
  VAR=$(git diff --cached --diff-filter=ACMR | grep -wiE &#34;var_dump|echo|exit|dd|die|console.log&#34;) if [ !...</p>
  </section>
  <footer class="entry-footer"><span title='2021-08-16 19:03:01 +0800 CST'>August 16, 2021</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to php-tips" href="https://www.soundpill.cn/posts/2021-08-16-php-tips/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>go-tips
    </h2>
  </header>
  <section class="entry-content">
    <p>当把时间作为一个变量传递时，可能会导致的问题，比如：  waitTime := 30 wait := waitTime * time.Second 这样子是错误的，因为 waitTime 不是 time.Duration 类型，但如果直接写 30 * time.Second 就会成功 在不太了解的情况下，我手动把 waitTime 通过“诡异”的方式变成了 time.Duration 类型
waitTime := 30 * time.Second wait := waitTime * time.Second 这种情况下 wait 的值就变成了 88 万小时，不是预想的结果，正确的写法如下：
waitTime := 30 wait := time.Duration(waitTime) * time.Second  当 waitGroup 使用时要清楚的知道 Done 方法的执行次数，如果是类似递归的结构，执行了多次 Done 方法，则会导致waitGroup 的计数器溢出，导致边界错误，如下：  这段代码运行时会导致 panic: sync: negative WaitGroup counter，所以我们在实际编写代码的过程中，如果有类似的情况，可以通过将有限次数的递归转换为迭代的形式来规避这种问题。总之，你需要明确的知道 Done 方法执行了几次。
  在 goroutine 使用的过程中我们是无法拿到当前 goroutine 的报错信息的，从而可能需要额外建立一个通道，将报错信息传递到某一个 channel 中，然后监听 channel 来进行错误处理。官方提供了一项实验功能，可以用来解决这个问题。官方包在这里：golang....</p>
  </section>
  <footer class="entry-footer"><span title='2021-08-16 18:40:38 +0800 CST'>August 16, 2021</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to go-tips" href="https://www.soundpill.cn/posts/2021-08-16-go-tips/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>一道go面试题
    </h2>
  </header>
  <section class="entry-content">
    <p>一道 Go 面试题 请问下面这两段代码分别输出什么? 直接说结果, 如果你的电脑不是奔腾, 赛扬什么的处理器, 那结果基本是固定的, 就是啥也没有. 因为在 goroutine 反应过来之前, 程序已经执行完了, 还没来得及输出就结束了.
要么, 你就让时间延迟几秒再结束, time.Sleep(10 * time.Second), 要么就像下面这样使用 WaitGroup 来等待 goroutine 结束 这不是问题的重点, 重点是这两种使用匿名函数的方式, 输出会有什么不一样吗?
首先说第一种, 没有传参的情况下, 匿名函数中是使用的引用地址来操作的, 这时候 i 可能已经加到 10 了, 所以打印出来可能会是 10 个 10, 或者中间夹杂几个其他数字什么的. (而且这时候 goroutine 总是在 i&#43;&#43; 之后执行, 所以是从 1 - 10, 不是 0 - 9)
第二种情况, 显而易见就是乱序的了, 会把 0 - 9 挨个输出, 但是是乱序的</p>
  </section>
  <footer class="entry-footer"><span title='2021-01-18 21:50:43 +0800 CST'>January 18, 2021</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to 一道go面试题" href="https://www.soundpill.cn/posts/2021-01-18-go-question/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>i&#43;&#43;是原子操作吗?
    </h2>
  </header>
  <section class="entry-content">
    <p>i&#43;&#43; 是原子操作吗? 不是, i&#43;&#43; 要完成的操作要先读取变量 i 的值, 对这个值加 1, 再把结果保存到 i 中. 所以不是原子操作.
我们来看下面的代码
这段代码是启动 10 个线程, 每个线程对 count 执行 10 万次自增操作, 直观上来看最后 count 的结果是 100 万, 但因为自增操作不是原子性的, 所以最终的结果每次都会不一样, 会有协程做重复操作. 那应该怎么解决这个问题呢? 并发资源的读取问题最直接的解决方法就是加锁. 改良后如下:</p>
  </section>
  <footer class="entry-footer"><span title='2021-01-17 09:47:29 +0800 CST'>January 17, 2021</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to i&#43;&#43;是原子操作吗?" href="https://www.soundpill.cn/posts/2021-01-17-iplusplus/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>Gerrit概念说明及使用
    </h2>
  </header>
  <section class="entry-content">
    <p>Gerrit介绍 Gerrit简介 Gerrit, 一种开放源代码的代码审查软件, 使用网页界面. 利用网页浏览器, 同一个团队的软件开发者, 可以相互审阅彼此修改后的代码, 决定是否能够提交, 回退或是继续修改. 它使用版本控制系统Git作为底层.
它分支自Rietveld, 作者为Google公司的Shawn Pearce, 原先是为了管理Android项目而产生. 这个软件的名称, 来自于荷兰家具设计师赫里特·里特费尔德(Gerrit Rietveld).
因为对访问控制表(ACL)相关的修正, 没有被集成进Rietveld, 之后Gerrit就由Rietveld分支出来, 形成独立软件项目.
最早它是由Python写成, 在第二版后, 改成用Java与SQL. 使用Google Web Toolkit来产生前端的JavaScript.
为什么需要Gerrit 首先, 代码审查可以帮助程序员了解系统功能, 从整体掌控代码质量, 其次, 通过代码审核可以及时止损, 构建更加健壮的系统代码.
代码审核的建议(来自程序员客栈)   对事不对人, 大家都是同事, 在一个团队工作和气最重要. 不要在Code Review中说&#34;你写的什么垃圾&#34;这种话, 你可以说&#34;这个变量名不是很好理解, 咱们换成xxx是不是更好&#34;
  每个Review至少给一条正面评价. Gerrit中有对代码点赞的功能, 可以时不时的使用一下.
  保证发布的代码和评审意见的可读性.
  用工具进行基础问题的自动化检查. 用Tab还是空格, 用两个空格还是四个空格, 缩进风格是使用K&amp;R还是Allman. 这些问题可以使用php code sniffer解决, 团队应该把精力放在代码规范, 代码性能优化等地方.
  全员参加Code Review, 并设定各部分负责人.
  每个代码PR(Pull Request)内容一定要少....</p>
  </section>
  <footer class="entry-footer"><span title='2020-09-23 18:35:52 +0800 CST'>September 23, 2020</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to Gerrit概念说明及使用" href="https://www.soundpill.cn/posts/2020-09-23-gerrit-desc/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>为什么没有使用索引?
    </h2>
  </header>
  <section class="entry-content">
    <p>为什么没有用索引? 已知表 a 数据总量是 40w, 根据时间范围过滤出最近 7 天的数据, 语句如下:
explain SELECT `question_id`, `student_id`, `teacher_id`, `question_type`, `question_step`, `question_no`, `level`, `class_id`, `lesson_id`, `teacher_get_at`, `teacher_set_at`, `status`, `teacher_from`, `wrong_reason_id`, `created_at`, `submit_time` FROM `answer_records` WHERE `updated_at` BETWEEN &#39;2020-07-14&#43;00:00:00&#39; AND &#39;2020-07-21&#43;00:00:00&#39; ORDER BY `created_at` DESC; 从 explain 返回的数据来看, 这条语句并没有使用到索引, 而且 mysql 进行了全表的扫描, 这个原因就是我们要查询的数据太多了.
因为 innodb 引擎会在检索索引后进行回表的操作, mysql 觉得你查询的数据这么多, 我一个个回表的这点时间都可以把全表扫一次了, 我就没必要用索引再去回表了, 所以就会导致这个索引没有用到.
那我们就想用索引, 应该怎么办呢?
FROM `answer_records` FORCE INDEX(rqx) 在业务层面的话, 如果时间范围比较大, 可以分批次查询, 这样就会快一点, 如果是频繁需要此类操作的话, 还是建议将时间戳提早设计进表结构里, 通过 int 类型的时间戳进行范围查找和排序会事半功倍</p>
  </section>
  <footer class="entry-footer"><span title='2020-09-23 11:41:43 +0800 CST'>September 23, 2020</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to 为什么没有使用索引?" href="https://www.soundpill.cn/posts/2020-09-23-why-index-unuse/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>在图片上添加文字或图片
    </h2>
  </header>
  <section class="entry-content">
    <p>intervention/image 这是一个第三方扩展, 用来处理图片的, 功能特别强大, 可以 cover 我们这篇文章提到的需求
安装文档: http://image.intervention.io/getting_started/installation
我们首先在项目中引入这个包:
$ composer require intervention/image 其次, laravel 中需要发布配置文件:
php artisan vendor:publish --provider=&#34;Intervention\Image\ImageServiceProviderLaravel5&#34; lumen 中需要修改 bootstrap.php, 在当中手动注册
$app-&gt;register(\Intervention\Image\ImageServiceProviderLumen::class); 该扩展默认使用的是 GD 库, 如果你想用 Imagick 扩展需要修改文件, config/image.php
&lt;?php return [ &#39;driver&#39; =&gt; &#39;imagick&#39; ]; 如果你不想要每次 use 都使用全路径, 可以按照官方所述将 Image 关键字写入 alias 中
 Laravel: config/app.php  $providers: Intervention\Image\ImageServiceProvider::class $aliases: &#39;Image&#39; =&gt; Intervention\Image\Facades\Image::class  Lumen: bootstrap/app.php  $app-&gt;withAliases(array(&#39;Intervention\Image\Facades\Image&#39; =&gt; &#39;Image&#39;)); 具体使用 use Image; public function deal() { $image = Image::make(public_path() ....</p>
  </section>
  <footer class="entry-footer"><span title='2020-01-10 15:43:41 +0800 CST'>January 10, 2020</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to 在图片上添加文字或图片" href="https://www.soundpill.cn/posts/2020-01-10-draw-someting-on-picture/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>比较两个字符串是否相等
    </h2>
  </header>
  <section class="entry-content">
    <p>有时候, 当用户传入一个字符串时, 你可能会需要拿着这个字符串和最终结果相对比, 如果我们使用 == 号来比较两个字符串, 可能会产生时序攻击.
&#39;abcdef&#39; == $req-&gt;code 也就是说, == 号在判断两个字符串相等时, 会一位一位的判断, 如果遇到哪一位不一样, 就返回错误, 这样根据服务器运算速度, 就可以一位一位的猜出最终的结果.
php 官方提供了避免时序攻击的字符串比较函数, 就是 hash_equals 无论两个字符串是否相等, 本函数的时间消耗是恒定的.
文档如下: https://www.php.net/manual/zh/function.hash-equals.php</p>
  </section>
  <footer class="entry-footer"><span title='2020-01-10 15:34:56 +0800 CST'>January 10, 2020</span>&nbsp;·&nbsp;max</footer>
  <a class="entry-link" aria-label="post link to 比较两个字符串是否相等" href="https://www.soundpill.cn/posts/2020-01-10-compare-two-string-equal/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="next" href="https://www.soundpill.cn/page/2/">Next Page »</a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://www.soundpill.cn">Beoning</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
