---
layout:     post
title:      "i++是原子操作吗?"
date:       2021-01-17 09:47:29 +0800
author:     "max"
---

# i++ 是原子操作吗?

不是, i++ 要完成的操作要先读取变量 i 的值, 对这个值加 1, 再把结果保存到 i 中. 所以不是原子操作.

我们来看下面的代码

![](http://img.fulitu.club/waitgroup.png?123)

这段代码是启动 10 个线程, 每个线程对 count 执行 10 万次自增操作, 直观上来看最后 count 的结果是 100 万, 但因为自增操作不是原子性的, 所以最终的结果每次都会不一样, 会有协程做重复操作. 那应该怎么解决这个问题呢? 并发资源的读取问题最直接的解决方法就是加锁. 改良后如下:

![](http://img.fulitu.club/waitgroup-lock.png)
